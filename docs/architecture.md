
# 系统架构说明：简单、务实、可靠

“心流静岛”的系统架构，可以用一个简单的比喻来理解：**它就像一家分工明确的餐厅。**

-   **网页端 (Web UI)** 是 **“大堂经理兼厨师”**：他负责聆听您的需求（语音），然后直接在厨房里把菜（PNG图片）做好。
-   **服务器 (Server)** 是 **“传菜员”**：他只负责把厨师做好的菜（PNG图片）端过来，放在出餐口。
-   **墨水屏设备 (Watchy)** 是 **“顾客”**：他会定时起身，去出餐口取走最新的那盘菜（PNG图片），然后回到座位上慢慢享用。

这个架构的核心哲学是：**将最复杂的烹饪工作，交给能力最强的厨师（您的浏览器），而传菜员和顾客（服务器和设备）则只做最简单、最不容易出错的事。**

---

## **1. 各组件的职责**

#### **1.1. 网页端 (Web UI)：大脑与画师**
-   **做什么？**
    1.  **聆听**: 使用浏览器自带的语音识别功能，把您说的话变成文字。
    2.  **理解**: 把这段文字发送给AI，让AI分析出哪些是重要的事。
    3.  **绘制**: 用网页技术（Canvas），把AI分析出的结果，**画成一张完整的、所见即所得的图片**。这张图不仅有文字，还有实时的时间和日期。
    4.  **发送**: 把画好的图片，发送给“传菜员”（服务器）。
-   **定位**: 它是整个系统的**“创意中心”**和**“单一真理之源”**。所有我们看到的最终画面，都在这里被创造出来，确保了“预览”和“实物”的绝对一致。

#### **1.2. 本地服务器 (Server)：忠诚的信使**
-   **做什么？**
    1.  **接收**: 从网页端接收画好的图片。
    2.  **打包**: 对图片做一些技术处理（比如移除透明背景），确保墨水屏设备能看懂。
    3.  **暂存**: 在内存里保存好**最新**的一张图片。
    4.  **递送**: 当墨水屏设备来询问时，把这张最新的图片递给它。
-   **定位**: 一个极致轻量、稳定可靠的**“图像中转站”**。它不负责思考或创作，只负责传递，这使得它几乎不会“生病”（崩溃）。

#### **1.3. 墨水屏设备 (Watchy)：专注的画布**
-   **做什么？**
    1.  **唤醒**: 每隔一段时间（比如15分钟）从“睡眠”中醒来。
    2.  **获取**: 连上Wi-Fi，向服务器要最新的那张图片。
    3.  **显示**: 把图片直接显示在屏幕上。
    4.  **休眠**: 断开网络，再次“睡去”，以节省电力。
-   **定位**: 一个纯粹的**“显示终端”**。它不需要认识任何文字，也不需要思考如何排版，只需要“照样子显示图片”即可。这使得它的任务非常简单，运行极其稳定。

---

## **2. 架构的演进：我们为何选择这样做？**

这个看似简单的架构，其实是我们经过一次关键抉择后的成果。

### **最初的尝试：让“传菜员”也当“厨师” (已被废弃)**
-   **工作方式**: 网页端把“订单”（文字）发给服务器，服务器自己来“做菜”（生成图片）。
-   **遇到的问题**:
    -   **“货不对板”**: 网页上预览的样子，和服务器最终做出来的菜，总有点不一样（比如字体、排版有细微差别），这让用户感到困惑。
    -   **“厨房太乱”**: 服务器既要当传菜员，又要当厨师，身兼数职，变得复杂且容易出错。

### **最终的方案：让专业的人做专业的事**
-   **改变**: 我们决定，让能力最强的网页端（浏览器）**全权负责“做菜”**。
-   **带来的好处**:
    -   **所见即所得**: 预览和最终的图片，由**完全相同**的代码生成，保证了视觉上的100%一致。
    -   **责任清晰**: 每个组件只做一件事，系统变得更简单、更可靠。
    -   **性能更优**: 充分利用了现代浏览器强大的绘图能力，解放了服务器和嵌入式设备，让整个系统运行得更流畅。
-   **一个务实的权衡 (Trade-off)**:
    -   为了换取这种极致的可靠性，我们接受了一个限制：**手表屏幕上的时钟不会每秒都跳动**，它显示的是图片生成那一刻的时间。对于一个核心价值是“显示最重要的事”的产品而言，这是一个完全可以接受、且非常务实的权衡。

---

## **3. “敬老版”的硬件升级**

在软件架构稳定后，“敬老版”对物理硬件进行了重大升级，以服务于新的**“守望”**使命。

-   **屏幕**: 从 1.54英寸方屏，升级到 **2.7英寸宽屏**，让字更大、更清晰。
-   **交互**: 从四个复杂的物理按键，简化为**唯一的、大尺寸的“一键呼救”侧键**，并以语音为主要交互方式。
-   **反馈**: 新增**高亮侧边灯条**，为夜间照明和紧急警报，提供了超越屏幕的、更醒目的视觉反馈。

这个硬件的演进，是“心流静岛”从一个信息工具，彻底转变为一个生命守望者系统的物理体现。
