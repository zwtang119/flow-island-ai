# 更新日志 (Changelog)

所有此项目的重要变更都将记录在此文件中。

## [4.2.0] - 项目完结与文档定稿 ("Final" Release)

### ✨ 新增与优化
- **项目状态**: 标志着项目的主要调试与开发阶段已圆满结束，当前版本 (`v5.0.0`) 已达到稳定发布标准。
- **文档终极优化**: 为确保项目的可维护性和用户友好性，对所有文档 (`README.md`, `GUIDE.md` 及其所有子模块) 进行了全面的专业化语言润色、结构优化和内容增强。
    - **提升清晰度**: 简化了语言，强化了结构，确保所有指南都清晰、严谨且易于遵循。
    - **增强用户体验**: 在固件指南中，对需要用户修改的配置部分进行了高亮强调；在故障排查指南中，新增了“初始系统检查”步骤，指导用户通过浏览器验证核心功能，从而极大地简化了调试流程。
    - **确保一致性**: 统一了所有文档的风格、术语和格式，使其共同构成了一套专业、内聚的技术手册。

## [4.1.4] - 服务器端PNG Alpha通道移除

### 修复
- **服务器**: 实现了服务器端的图像处理，以从根本上解决 `ERROR: PNG Decode Failed` 问题。

### 变更
- **引入 `sharp` 库**: 在本地服务器中集成了 `sharp` 图像处理库，并更新了安装指南。
- **自动移除透明通道**: 所有通过 Web UI 上传的 PNG 图片，现在都会在服务器端被自动处理，移除其 Alpha (透明) 通道，并以 Watchy 固件完全兼容的 24-bit RGB PNG 格式进行存储。
- **原因**: 此项修复从根本上解决了因浏览器生成的 PNG 格式与 Watchy `PNGdec` 解码库不兼容而导致的显示失败问题，确保了图像显示的最终可靠性。

## [4.1.3] - 固件健壮性终极版 ("Failsafe" Firmware)

### 修复
- **固件**: 引入了 "Failsafe" 版本的固件，其核心设计目标是确保设备在任何网络或数据异常情况下都**不会死机、挂起或崩溃**，优先保证系统的绝对可靠性。

### 变更
- **增强错误处理**: 新固件为数据同步的每一个关键步骤（`WiFi连接`、`服务器访问`、`图像数据下载`、`PNG打开`、`PNG解码`）都增加了独立的、带有超时的验证逻辑，并能在失败时于屏幕上显示具体、明确的错误信息。
- **强化稳定性**: 实施了更积极的硬件看门狗 (Watchdog) 管理策略，并在每个循环和网络操作中重置计时器，确保设备在遇到意外的软件挂起时能够自动恢复。
- **优化资源管理**: 在每次网络操作后，固件都会显式地关闭 Wi-Fi 模块，以节省功耗并防止潜在的连接状态问题。

## [4.1.2] - 关键固件修复 (Critical Firmware Hotfix)

### 修复
- **固件**: 根据社区的深度代码审查，对 v4.0.0 版本的固件进行了关键性修复，旨在彻底解决 `ERROR: PNG Open Failed` 问题并提升长期运行的稳定性。
    - **修正 PNG 解码逻辑**: 修正了 `fetchAndDrawImage` 函数中对 `png.openFLASH()` 成功返回值的判断条件，从错误的 `== 1` 改为正确的 `== PNG_SUCCESS`。这是解决问题的核心。
    - **增加内存缓冲区**: 将 PNG 图像的内存缓冲区 `PNG_BUFF_SIZE` 从 8KB 扩大至 16KB，以避免因 HTTP 头数据导致潜在的内存溢出。
    - **增强 Wi-Fi 稳定性**: 在 `connectWiFi` 函数中启用了自动重连 (`setAutoReconnect`)，提升了设备在网络波动环境下的连接可靠性。

## [4.1.1] - 固件显示修复 (Firmware Display Hotfix)

### 修复
- **服务器**: 修正了 `/api/image` 接口的 HTTP 响应头。将 `Content-Type` 从 `application/octet-stream` 更改为正确的 `image/png`，并添加了 `Content-Length` 头。此项修复解决了 Watchy 固件因 MIME 类型不匹配而无法打开 PNG 数据流，从而导致 `ERROR: PNG Open Failed` 的核心问题。

## [4.1.0] - 服务器IP检测增强

### 变更

- **服务器**: 重构了 `server.js` 的IP地址检测逻辑。现在启动时会列出所有可用的局域网IP地址，而不仅仅是第一个。此项变更旨在帮助用户在复杂的网络环境（例如，同时使用WSL或移动热点）中，能够更轻松、更准确地选择用于固件配置的IP地址。

## [4.0.2] - 文档：新增 VPN 故障排查指南

### 变更

- **文档**: 根据用户的实际部署经验，在 `docs/03-TROUBLESHOOTING.md` 的 “Web UI 浏览器问题” 部分，新增了一个关于 `AI 请求失败 (Network Error) 与 VPN 配置` 的故障排查条目。该指南详细解释了在需要使用VPN访问AI服务的场景下，为何必须将VPN客户端设置为“绕开局域网(Bypass LAN)”或“分割隧道(Split Tunneling)”模式，以避免与本地服务器的连接冲突。

## [4.0.1] - 社区驱动的故障排查指南增强 (Community-Driven Troubleshooting Enhancement)

### ✨ 新增与优化

- **增强故障排查指南**: 根据社区关于 `ERROR: Server Conn Failed` 错误的精准反馈，对 `docs/03-TROUBLESHOOTING.md` 进行了重大优化。
- **聚焦核心问题**: 将针对 `Server Conn Failed` 的解决方案**置于故障排查部分的最顶部**，并标记为“最常见问题”，使用户能第一时间找到解决方案。
- **提供分步清单**: 新的指南提供了一个清晰的、从上到下、按可能性排序的四步排查清单（IP地址 -> 服务器运行 -> 防火墙 -> 网络环境），旨在引导即便是新手用户也能独立解决这个最常见的部署障碍。
- **提升部署成功率**: 本次更新旨在大幅提升新用户的首次部署成功率，减少因网络配置问题带来的挫败感。

## [4.0.0] - “奥德赛引擎”架构重构 (Odyssey Engine Architectural Refactor)

### 💥 重大变更

- **核心架构重构: "整图渲染" (Full Image Rendering)**
  - **固件简化**: 为了从根本上解决字体渲染问题（如中文乱码）并最大化可靠性，Watchy 固件被彻底重构。它**不再包含任何字体数据或文本绘制逻辑**。其唯一职责是：从服务器下载一张完整的 200x200 像素图片并将其显示在屏幕上。
  - **Web UI 职责**: Web UI (`index.html`) 现在负责绘制**整个表盘**，包括大号时钟、日期和 AI 备忘录，生成一张像素级完美的 PNG 图片。
- **移除固件依赖**: 固件中所有与字体相关的代码和数据均已被移除，使其更轻量、更稳定、更易于维护。

### ✨ 核心收益

- **所见即所得 (WYSIWYG)**: 手表上的显示效果将与 Web 预览**完全一致**，彻底解决了所有字体兼容性、布局和乱码问题。
- **可靠性优先**: 将复杂的渲染任务从资源受限的 ESP32 转移到浏览器，从根本上消除了因内存或字体问题导致的固件崩溃风险。
- **设计取舍**: 手表上的时钟**不再每分钟实时更新**，而是仅在与服务器同步时（例如，每15分钟）更新。这是为了换取 100% 可靠的视觉保真度和系统稳定性而做出的设计决策。

---

### 📚 历史版本 (Archived Versions)

- **[查看 v3.x.x 版本更新历史](./docs/changelog/CHANGELOG-v3.md)**
- **[查看 v1.x.x & v2.x.x 版本更新历史](./docs/changelog/CHANGELOG-v1-v2.md)**